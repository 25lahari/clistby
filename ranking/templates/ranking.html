{% load filters %}
<html>
    <head>
        <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
        <title>Ranking</title>
        <style type='text/css'>
            a {
                color: #3a75c4;
                text-decoration: none;
            }

            .vertical {
                -moz-transform:rotate(-90deg);
                -webkit-transform:rotate(-90deg);
                -ms-transform:rotate(-90deg);
                font-size: 90%;
                margin: 150px -150px 150px -150;
            }

            #tooltip {
                z-index: 9999;
                position: absolute;
                display: none;
                top: 0px;
                left: 0px;
                background-color: #000;
                padding: 5px 10px 5px 10px;
                color: white;
                opacity: 0.75;
                border-radius: 5px; 
            }
            table {
                overflow-x: scroll;
                width: {{ contests|length|multiply:25|addition:300 }}px;
                border-collapse: collapse;
                border: 1px solid black;
                align: center;
                white-space: nowrap;
            }
        </style>
        <script src='http://code.jquery.com/jquery-1.8.3.js' type='text/javascript'></script>
        <script type='text/javascript'>
            $(window).load(function(){
                $('[data-tooltip]').mousemove(function (eventObject) {
                    $data_tooltip = $(this).attr('data-tooltip');
                    $('#tooltip').html($data_tooltip).css({'top': eventObject.pageY + 10, 'left': eventObject.pageX + 10}).show();
                }).mouseout(function () {
                    $('#tooltip').hide().text('').css({'top': 0, 'left': 0});
                });
            });
        </script>
    </head>
    <body>
        <div id='tooltip'></div>
        <table align='center' border='1' cellpadding="2">
        <tr>
            <th valign='bottom' align='right'>Участник</th>
            <th valign='bottom'>Очки</th>
            {% for c in contests %}
            <th width='20px'><div class='vertical'><a href="{% url 'ranking:contest' c.contest__id %}">{{ c.contest__title|truncatechars:30 }}</a></div></th>
            {% endfor %}
        </tr>
        {% for result in results %}
        <tr align='center'>
            <td align='right'>{{ result.member.name }} {{ result.member.surname }}</td>
            <td>{{ result.score }}</td>
            {% for c in contests %}
            {% with stat=result.contests|get_item:c.contest %}
            <td{% if stat|get_item:'addition' %} data-tooltip='{% for k, v in stat|get_item:'addition'|json_loads|iteritems %}{% if v %}{{ k }}: {{ v }}<br/>{% endif %}{% endfor %}'{% endif %}>
                {% if stat %}
                    {% if stat|get_item:'url' %}<a href='{{ stat|get_item:'url'}}'>{% endif %}
                    {{ stat|get_item:'score' }}
                    {% if stat|get_item:'url' %}</a>{% endif %}
                {% else %}
                    -
                {% endif %}
            {% endwith %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
        </table>
    </body>
</html>
